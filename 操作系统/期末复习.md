[TOC]



# 第一章 操作系统引论

## 操作系统的功能

是一个系统软件，它管理计算机的软硬件资源，并为计算机程序提供提供服务

## 多道、并发OS含义

多道：计算机内存放几道相互独立的程序，相互穿插进行，宏观上并行，微观上串行

并发：一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个[处理机](https://baike.baidu.com/item/处理机)上运行，但任一个时刻点上只有一个程序在处理机上运行

并行：当系统有一个以上CPU时,则线程的操作有可能非并发。

## 多道批处理OS、分时OS、实时OS的基本特性

### 多道：见上

### 分时OS：

时操作系统是使一台计算机同时为几个、几十个甚至几百个用户服务的一种操作系统。把计算机与许多终端用户连接起来，分时操作系统将系统处理机时间与内存空间按一定的时间间隔，轮流地切换给各终端用户的程序使用。

### 多道分时区别：

分时操作系统是给不同用户提供程序的使用，而多道程序系统则是不同程序间的穿插运行。

  总之，分时操作系统主要是针对于多用户来说的，而多道程序系统主要是针对于多程序来说的

### 实时

实时操作系统主要用于过程控制、事务处理等有实时要求的领域。除了与分时系统相似的外在特征外，对系统的实时性和可靠性要求更为严格。

实时系统的特征：     实时系统具有专用性、种类多、用途各异等特点，其一个基本特征是事件驱动，即接收到某些外部信息后，由系统选择某一程序去执行，完成相应的实时任务。

## 分时OS基本特点

分时系统的特点：

同时性或多路性：多用户同时操作、使用计算机；

独占性：各终端用户感觉到自己独占了计算机；

及时性：用户的请求能在较短时间内相应；

交互性：用户能计算机进行人——机对话。

## 操作系统基本特征

并发性、共享性、异步性、虚拟性

### 并发性

在多道程序处理时，宏观上并发，微观上交替执行（在单处理器情况下） 。

### 共享性

资源在一个时间段内交替被多个进程所用。

互斥共享方式（如大多数物理设备，栈，内存变量），资源分配后到释放前，不能被其他进程所用。

同时访问方式，（如可重入代码，磁盘文件）

### 异步性

异步性也称不确定性，指进程的执行顺序和执行时间及有可能执行结果的不确定性：程序执行结果不确定，不可再现。

相同输入与环境，多次运行结果不同。

多道程序设计环境下，程序按异步方式运行。多个进程并发执行，“时走时停”，不可预知每个进程的运行推进快慢，引发执行顺序与时间的不确定。 

### 虚拟性

一个物理实体映射为若干个对应的逻辑实体（分时或分空间）。

虚拟是操作系统管理系统资源的重要手段，可提高资源利用率。 

OS实现虚拟物理实体的技术：分时和分空使用设备，这样一个设备就虚拟成多个虚拟设备。 

## OS五大基本功能含义

主要功能如下：

  1）处理机管理  

  2）存储管理  

  3）设备管理  

  4）信息管理 

  5）用户接口

### 处理机管理

进程管理，包括以下方面 

进程控制。创建进程，撤销进程，控制进程的运行状态转换，为一个进程创建和撤销线程。

进程调度。从就绪的进程（线程）队列中选择一进程（线程）并把处理机分配给它，设置现场并投入运行。

进程同步。设置进程同步信息，以协调系统中各进程的运行。包括进程互斥访问和进程同步。

进程通讯。负责进程间的信息交换。

### 存储管理

为多道程序的运行提供良好的环境，并提高利用率，包括以下方面：

地址重定位（地址映射）。实现逻辑地址到物理地址的转换。

存储分配。为每道程序分配内存空间，并在作业结束后收回其所占用内存。

存储保护。保证每道程序之间不能互相侵犯，尤其是不能侵犯操作系统。

存储扩充。通过建立虚拟存储系统来实现内存逻辑上的扩充。

### 设备管理

设备管理的主要目标是方便的设备使用、提高CPU与I/O设备利用率。

主要包括：

缓冲管理：设立I/O缓冲区（内存），并对缓冲区进行有效管理。

设备分配：按一定策略和设备使用情况，分配并回收设备。

设备处理：即设备驱动程序，实现CPU和设备控制器之间的通讯等。

设备独立性和虚拟设备：独立性指应用程序独立于物理设备，使用户编程与实际使用的设备无关，增强了可移植性。虚拟设备指将低速的设备改造为高速的共享设备。

### 信息管理

对用户文件和系统文件进行管理，解决文件资源的存储、共享、保密和保护。

包括以下方面：

目录管理：为每一文件建立目录项，并对目录实施有效的组织与管理。

文件的读写管理和存取控制：解决信息安全问题。系统设口令“哪个用户”、用户分类“哪个用户组”、文件权限“针对用户或用户组的读写权”。

文件存储空间管理：解决如何存放信息，以提高空间利用率和读写性能。

软件管理：软件的版本、相互依赖关系、安装和拆除等。



### OS与用户接口

目标是提供一个友好的用户访问操作系统的接口。

操作系统提供三种接口：

命令接口：亦称为作业控制机接口，分为联机命令和脱机命令接口。供用户用于组织和控制自己的作业运行。命令行；命令脚本“脱机”。

程序接口：用户获得操作系统服务的唯一途径。供用户程序和系统程序调用操作系统功能。系统调用和高级语言库函数。

图形接口：图形用户界面GUI，方便用户使用。如窗口、菜单等。

## 中断

Linux系统的系统调用通过（0x80）中断实现

DOS系统的系统调用，通过（21H）中断号实现

## 库函数（fwrite）被调用到系统调用write的执行具体过程

fwrite函数在glibc库中调用系统调用write，使系统陷入内核态，在内核态查找系统调用表

# 第二章

## 进程

### 概念

进程（强调并发性和动态性）： 可以并发执行的程序在某个数据集合上的运行过程，是系统进行资源分配和调度的独立单位，并发的基本单位。

### 状态转换

![image-20230222160819448](/home/erfenjiao/.config/Typora/typora-user-images/image-20230222160819448.png)

调度: 就绪 → 运行            

超时: 运行 → 就绪

I/O请求/等待事件: 运行 → 阻塞

I/O完成/等待事件发生: 阻塞 → 就绪     

挂起: 活动 → 静止     

激活: 静止 → 活动

### 程序和进程比较

1. 程序是永存的(除非删除)；进程是暂时的，是程序在数据集上的一次执行，有创建有撤销，存在是暂时的；
2. 程序是静态的观念，进程是动态的观念；
3. 进程具有并发性，而程序没有；
4. 进程是竞争计算机资源的基本单位，程序不是。
5. 进程和程序不是一一对应的： 一个程序可对应多个进程即多个进程可执行同一程序； 一个进程可以执行一个或几个程序。

### 进程控制原语

进程控制原语：

1）进程创建原语，create()

2）进程撤消原语, destroy ()

3）阻塞原语、唤醒原语,block()、wakeup()

4）挂起原语、激活(解挂)原语,suspend()、active()

# 第三章 进程同步

## 进程同步与互斥

### 记录型信号量

在整型信号量机制中的wait操作，只要是信号量S<=0,就会不断测试。因此，该机制并未遵循“让权等待”准则，而是使进程处于“忙等”状态。

记录型信号量机制则是一种不存在“忙等”现象的进程同步机制。

但在采取了“让权等待”的策略后，又会出现多个进程等待访问同一个临界资源的情况。为此，在信号量机制中，除了需要一个用于代表资源数目的整型变量value外，还应该增加一个进程链表指针L，用于链接上述的所有等待进程。

记录型信号量是由于它采用了记录型的数据结构而得名的。

## 死锁

### 死锁条件



### 对死锁采取的策略



## 经典问题

### 生产者消费者问题



### 读写问题



### 哲学家问题



### 分橘子问题



# 第四章 存储管理

存储管理概述

早期的存储管理技术

页式存储管理

段式存储管理

段页式存储管理

虚拟存储器基本概念

请求分页式存储管理

页面置换算法



## 4.1 存储管理概述

内存空间: 是由存储单元(字节或字)组成的一维连续的地址空间。

内存空间用来存放当前正在运行程序的代码及数据, 是程序中指令本身地址所指的、亦即程序计数器所指的存储器。

## 4.2 动态重定位

在装入模块装入内存后，并不立即把装入模块中的相对地址转换为绝对地址，而是把这种转换推迟到程序真正要执行时才进行。

程序在内存中的位置可以改变, 因此边运行, 边装入,称动态重定位。地址变换在运行阶段完成。

## 4.3 程序的链接

源程序编译后，可得到一组目标模块，这组目标模块以及它们所需要的库函数装配成一个完整的装入模块。

### 静态链接-运行前链接

![image-20230222194038119](/home/erfenjiao/.config/Typora/typora-user-images/image-20230222194038119.png)



### 动态链接

装入前

运行时

## 4.4 存储管理技术

#### 可变分区的内存分配算法

首次适配算法



最佳适配



最差适配



下次适配

## 4.5 快表

利用程序的局部性特点，即一段时间会频繁访问程序的某个局部区域，因此可以将程序中当前频繁访问的代码和数据的地址映射关系存入一组寄存器中

它是介于内存与寄存器之间的存储机制, 为加快地址变换速度而设置;它的访问速度比页表快一个数量级, 它保存着正在运行进程的页表的子集(部分表项)。存放当前频繁访问的那些页表项,表项含:

1) 页号                      
2) 页在内存的块号
3) 淘汰位

物理块号 b 的地址= 页表始址+页号*页表项长度*

*物理地址 P = 物理块号*页的大小+页内地址

## 4.6 请求分页

### 管理原理











页式存储管理



段式存储管理

段页式存储管理

虚拟存储器基本概念

请求分页式存储管理

页面置换算法